---
import AuthorLayout from "../../layouts/AuthorLayout.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
	const allPosts = await getCollection("posts");

	// Get unique author slugs from all posts
	const uniqueAuthors = [
		...new Set(
			allPosts.flatMap((post) => {
				if (post.data.authorSlug) return [post.data.authorSlug];
				return [];
			})
		),
	];

	return uniqueAuthors.map((authorSlug) => {
		// Find the display name for this author slug
		const authorDisplayName =
			allPosts.find((post) => post.data.authorSlug === authorSlug)?.data.author || authorSlug;

		return {
			params: { slug: authorSlug },
			props: {
				authorSlug,
				authorDisplayName,
			},
		};
	});
}

const { authorSlug, authorDisplayName } = Astro.props;

const allPosts = await getCollection("posts");
---

<AuthorLayout title={authorDisplayName} posts={allPosts} description={``} authorSlug={authorSlug} />
